# 图片操作工具 - 产品需求文档

## 1. 产品概述

### 1.1 产品定位

一个基于浏览器的单页图片处理工具，用户上传图片后通过手动选择裁剪或填充模式，输出指定规格的图片（16:9 或 9:16）。

### 1.2 核心价值

- 简化图片适配固定规格的流程
- 提供裁剪和填充两种明确的处理方式
- 所见即所得的可视化操作界面
- 零学习成本，操作简单直观

### 1.3 业务目标

**输入**：任意尺寸图片（≥ 256×256px）  
**输出**：固定规格图片（16:9 或 9:16）

**处理方式**：

- **裁剪模式**：图片尺寸足够时，通过画框选择输出区域
- **填充模式**：图片尺寸不足时，移动图片并填充指定颜色

---

## 2. 功能需求

### 2.1 图片上传

#### 2.1.1 上传方式

- 点击上传按钮选择本地文件
- 拖拽图片到上传区域

#### 2.1.2 文件限制

- **支持格式**：JPG、PNG、WEBP、GIF（静态）
- **文件大小**：≤ 10MB
- **最小尺寸**：256×256px（低于此尺寸不允许上传，提示"图片尺寸过小，请上传至少 256×256 像素的图片"）
- **最大尺寸**：8000×8000px

#### 2.1.3 上传后行为

- 图片自动加载到画布区域
- 图片自动适配画布（保持宽高比，填满画布）
- 默认进入**裁剪模式**
- 画框默认居中显示（默认尺寸：16:9 为 1920×1080，9:16 为 1080×1920）

---

### 2.2 画框规格选择

#### 2.2.1 规格列表（V1.0）

- **16:9 风景**（横向）- 默认尺寸 1920×1080
- **9:16 人像**（竖向）- 默认尺寸 1080×1920

#### 2.2.2 规格列表（后续扩展）

- 1:1 正方形 - 默认尺寸 1080×1080
- 4:3 标准 - 默认尺寸 1920×1440
- 3:4 竖版标准 - 默认尺寸 1440×1920
- 自定义比例

#### 2.2.3 交互方式

- 单选按钮组（16:9 / 9:16）
- 切换规格时：
  - 保持当前模式（裁剪/填充）
  - 画框尺寸更新为新规格的默认尺寸
  - 画框位置重置为居中

---

### 2.3 模式切换

#### 2.3.1 两种模式

- **裁剪模式**（Crop Mode）：图片固定，画框可调整
- **填充模式**（Fill Mode）：画框固定，图片可移动

#### 2.3.2 切换方式

**手动切换**：用户通过工具栏按钮主动选择模式

**工具栏布局**：

```
[上传图片] [裁剪模式] [填充模式] [16:9] [9:16] [填充色] [导出]
```

#### 2.3.3 模式切换行为

- 切换模式时保持当前画框规格
- 切换到裁剪模式：
  - 画框变为可调整状态
  - 填充色选择器置灰（不可用）
- 切换到填充模式：
  - 画框固定在画布边界
  - 图片变为可移动状态
  - 填充色选择器激活

#### 2.3.4 设计理念

- **用户明确知道意图**：我是想裁图还是扩图
- **模式职责清晰**：裁剪模式不涉及填充色，填充模式才有填充色
- **无需复杂辅助**：约束规则已经足够简单，不需要辅助线/磁吸

---

### 2.4 裁剪模式（Crop Mode）

#### 2.4.1 模式说明

用户通过调整画框的大小和位置，选择图片的输出区域

**示例场景**：

- 9:16 全身照 + 9:16 画框 → 裁剪模式（默认全贴合）
- 16:9 风景照 + 16:9 画框 → 裁剪模式
- 16:9 风景照 + 9:16 画框 → 裁剪模式（可选择局部）

#### 2.4.2 图片状态

- 自动缩放至填满整个画布（保持宽高比）
- 固定不动，作为背景层
- 用户不能直接缩放或移动图片

#### 2.4.3 画框状态

**可操作**：可移动、可缩放

**约束规则**：

1. **尺寸约束**：

   - **最大尺寸** = 画布尺寸（即图片适配后的尺寸）
   - **最小尺寸** = 长边 256px 的对应比例矩形
     - 16:9 画框最小：256×144px
     - 9:16 画框最小：144×256px

2. **位置约束**：

   - 画框不能超出图片边界
   - 拖拽时自动限制在图片范围内

3. **比例锁定**：
   - 画框始终保持选定的宽高比（16:9 或 9:16）
   - 缩放时等比例调整

#### 2.4.4 交互操作

- **移动画框**：鼠标拖拽画框中心区域
- **缩放画框**：拖拽画框四角的控制点（等比例缩放）
- **双击重置**：双击画框恢复到最大尺寸并居中

#### 2.4.5 视觉反馈

- **画框外区域**：半透明黑色遮罩（rgba(0,0,0,0.5)）
- **画框内区域**：完整原图色彩
- **画框边框**：2px 白色边框 + 外阴影
- **控制点**：四角显示 8×8px 白色方块
- **鼠标样式**：
  - 画框中心：移动光标（move）
  - 控制点：缩放光标（nwse-resize / nesw-resize）

#### 2.4.6 填充色状态

- 填充色选择器**置灰**（不可用）
- 裁剪模式不涉及填充逻辑

---

### 2.5 填充模式（Fill Mode）

#### 2.5.1 模式说明

画框固定在画布边界，用户通过移动图片调整位置，空白区域自动填充指定颜色。

#### 2.5.2 画框状态

- **固定在画布边界**（画框 = 画布最大尺寸）
- 不可移动、不可缩放
- 显示边框作为视觉提示

#### 2.5.3 图片状态

**自动缩放规则**：

- 图片自动缩放至：**图片长边 = 画框短边**
- 保持图片原始宽高比
- 用户不能手动缩放图片

**可移动范围**：

- 图片可在画框内自由拖动
- 移动范围 = 画框边界
- 图片边缘不能超出画框边界

**初始位置**：

- **16:9 画框**：图片水平居中（左右等比填充）
- **9:16 画框**：图片垂直居中（上下等比填充）

#### 2.5.4 移动约束示例

**场景 1：1:1 图片（1000×1000）+ 9:16 画框（1080×1920）**

- 图片自动缩放至 1080×1080（宽度 = 画框宽度）
- 初始位置：垂直居中（上下各填充 420px）
- 可移动范围：上下移动 ±420px
- 移动效果：
  - 图片上移 200px → 上方填充 220px，下方填充 620px
  - 图片下移 200px → 上方填充 620px，下方填充 220px

**场景 2：9:16 图片（1080×1920）+ 16:9 画框（1920×1080）**

- 图片自动缩放至 608×1080（高度 = 画框高度）
- 初始位置：水平居中（左右各填充 656px）
- 可移动范围：左右移动 ±656px

**场景 3：9:16 图片（1080×1920）+ 9:16 画框（1080×1920）**

- 图片完全填满画框
- 无需填充，图片锁定不可移动
- 提示："图片已完全填满画框"

#### 2.5.5 交互操作

- **移动图片**：鼠标拖拽图片
- **双击重置**：图片恢复到居中位置

#### 2.5.6 视觉反馈

- **画框边框**：2px 白色边框（固定）
- **填充区域**：显示配置的填充颜色
- **图片可移动时**：鼠标悬停显示移动光标（move）
- **图片锁定时**：显示禁止图标，提示"图片已完全填满画框"

#### 2.5.7 填充颜色配置

**默认颜色**：白色 (#FFFFFF)

**预设颜色**：

- 白色：#FFFFFF
- 黑色：#000000
- 浅灰：#F5F5F5
- 透明：rgba(0,0,0,0)（仅 PNG 输出时可用）

**自定义颜色**：

- 颜色选择器（支持 HEX 输入）
- 实时预览填充效果

**UI 位置**：

- 顶部工具栏：颜色选择器按钮（显示当前颜色的色块）
- 点击后弹出颜色面板：
  - 4 个预设色块（可点击快速选择）
  - HEX 输入框（手动输入颜色值）
  - 确认/取消按钮

---

### 2.6 输出功能

#### 2.6.1 输出参数

**输出格式**：

- JPG（默认）
- PNG
- WEBP

**输出尺寸**：

- 跟随画框实际尺寸
- 裁剪模式：输出当前画框尺寸的图片
- 填充模式：输出画框尺寸（默认 1920×1080 或 1080×1920）

**输出质量**：

- JPG/WEBP：可调节质量（60-100，默认 90）
- PNG：无损压缩

#### 2.6.2 输出内容

- **裁剪模式**：输出画框内的图片区域
- **填充模式**：输出画框内的图片 + 填充区域（合成后的完整图片）

#### 2.6.3 交互流程

1. 点击"导出"按钮
2. 弹出导出配置面板：
   - 格式选择（JPG / PNG / WEBP）
   - 质量调节（JPG/WEBP 可用）
   - 预览输出尺寸（如 1080×1920）
3. 点击"下载"按钮
4. 浏览器自动下载文件
   - 文件名格式：`原文件名_processed_1080x1920.jpg`

---

## 3. 界面布局

### 3.1 整体结构

```
┌────────────────────────────────────────────────────────────┐
│  顶部工具栏                                                  │
│  [📤 上传] [✂️ 裁剪] [🖼️ 填充] [16:9] [9:16] [🎨] [⬇️ 导出] │
├────────────────────────────────────────────────────────────┤
│                                                            │
│                                                            │
│                        画布区域                             │
│                  （图片 + 画框 + 填充）                      │
│                                                            │
│                                                            │
├────────────────────────────────────────────────────────────┤
│  底部状态栏                                                  │
│  画框：1080×1920 | 原图：1000×1000 | 提示：拖动画框选择区域   │
└────────────────────────────────────────────────────────────┘
```

### 3.2 组件说明

#### 3.2.1 顶部工具栏

**上传按钮**：

- 图标 + 文字："上传图片"
- 点击打开文件选择器
- 支持拖拽上传

**模式切换**：

- **裁剪模式按钮**：图标 ✂️ + "裁剪"
- **填充模式按钮**：图标 🖼️ + "填充"
- 当前激活模式高亮显示（如蓝色背景）

**规格选择器**：

- 单选按钮组：[16:9] [9:16]
- 当前选中规格高亮显示

**填充色选择器**：

- 显示当前颜色的色块按钮（32×32px）
- 仅在填充模式下可用（裁剪模式时置灰）
- 点击弹出颜色面板

**导出按钮**：

- 图标 + 文字："导出"
- 主要操作按钮（如蓝色背景）

#### 3.2.2 画布区域

**容器**：

- 自适应浏览器窗口大小
- 居中显示
- 最大宽度/高度：90% 视口尺寸

**背景**：

- 浅灰色棋盘格（#F0F0F0 + #FFFFFF 交替）
- 便于查看透明图片

**图层结构**（从下到上）：

1. 背景层（棋盘格）
2. 图片层（自动适配画布）
3. 填充层（仅填充模式，显示填充颜色）
4. 画框层（边框 + 控制点）
5. 遮罩层（仅裁剪模式，画框外半透明黑色）

#### 3.2.3 底部状态栏

**显示信息**：

- **画框尺寸**：当前画框的像素尺寸（如"画框：1080×1920"）
- **原图尺寸**：上传图片的原始尺寸（如"原图：1000×1000"）
- **操作提示**：
  - 裁剪模式："拖动或缩放画框选择区域"
  - 填充模式（可移动）："拖动图片调整位置，空白区域已填充"
  - 填充模式（锁定）："图片已完全填满画框"

---

## 4. 技术约束

### 4.1 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 4.2 性能要求

- 图片加载时间：< 2s（5MB 图片）
- 画框操作响应：< 16ms（60fps）
- 导出处理时间：< 3s（5MB 图片）

### 4.3 技术栈建议

- **前端框架**：React / Vue 3
- **Canvas 库**：Fabric.js / Konva.js
- **UI 组件**：Ant Design / Element Plus
- **图片处理**：Canvas API / OffscreenCanvas

---

## 5. 用户场景示例

### 场景 1：裁剪全身照为头像

**需求**：9:16 全身照裁剪为头像

**操作流程**：

1. 上传 9:16 全身照（1080×1920）
2. 保持裁剪模式（默认）
3. 选择 9:16 画框（默认 1080×1920，全贴合）
4. 缩小画框至头部区域（如 600×1067）
5. 拖动画框对准头部
6. 点击导出 → 输出 600×1067 头像照

---

### 场景 2：正方形图适配竖屏（填充）

**需求**：1:1 图片适配 9:16 竖屏，上下填充白色

**操作流程**：

1. 上传 1:1 图片（1000×1000）
2. 点击"填充模式"按钮
3. 选择 9:16 画框（默认 1080×1920）
4. 系统自动处理：
   - 图片缩放至 1080×1080
   - 图片垂直居中（上下各填充 420px）
5. 在工具栏选择白色填充（#FFFFFF）
6. 上下拖动图片调整位置（可选）
7. 点击导出 → 输出 1080×1920 竖屏图（上下白色填充）

---

### 场景 3：风景照适配人像框（裁剪）

**需求**：16:9 风景照裁剪为 9:16 人像图

**操作流程**：

1. 上传 16:9 风景照（1920×1080）
2. 保持裁剪模式（默认）
3. 选择 9:16 画框（默认 1080×1920）
4. 画框默认居中显示（可能超出图片高度，自动调整为最大可用尺寸，如 608×1080）
5. 左右移动画框选择关键区域（如人物）
6. 可缩小画框聚焦局部（如 400×711）
7. 点击导出 → 输出实际画框尺寸的人像图

---

### 场景 4：横向图适配横向框（填充）

**需求**：9:16 人像图适配 16:9 横屏，左右填充黑色

**操作流程**：

1. 上传 9:16 人像图（1080×1920）
2. 点击"填充模式"按钮
3. 选择 16:9 画框（默认 1920×1080）
4. 系统自动处理：
   - 图片缩放至 608×1080
   - 图片水平居中（左右各填充 656px）
5. 在工具栏选择黑色填充（#000000）
6. 左右拖动图片调整位置（可选）
7. 点击导出 → 输出 1920×1080 横屏图（左右黑色填充）

---

## 6. 后续扩展功能

### 6.1 V1.1 版本

- [ ] 支持 1:1 正方形规格（默认 1080×1080）
- [ ] 支持 4:3、3:4 规格
- [ ] 渐变填充、图案填充
- [ ] 键盘快捷键支持（方向键微调、Ctrl+Z 撤销等）

### 6.2 V1.2 版本

- [ ] 批量处理功能（上传多张图片，统一处理）
- [ ] 自定义画框比例
- [ ] 导出预设（一键导出多种尺寸）
- [ ] 历史记录（撤销/重做）

### 6.3 V2.0 版本

- [ ] AI 智能裁剪（人脸识别、主体检测）
- [ ] 滤镜效果（黑白、复古、鲜艳等）
- [ ] 背景移除/替换
- [ ] 移动端触摸支持
- [ ] PWA 离线使用

---

## 7. 设计决策说明

### 7.1 为什么选择手动切换模式？

**理由**：

1. **用户意图明确**：用户清楚知道自己是想裁图还是扩图
2. **职责清晰**：裁剪模式不涉及填充色，填充模式才有填充色
3. **避免混淆**：不会出现"我想裁图但系统自动切到填充"的情况
4. **简化约束**：两种模式的约束规则已经足够简单，无需额外辅助

### 7.2 为什么不需要辅助线/磁吸？

**理由**：

1. **裁剪模式**：画框最大只能拉到图片边缘，边界自动限制
2. **填充模式**：画框固定，图片只能在画框内移动，范围自动限制
3. **约束规则简单**：不会出现"多裁/少裁几个像素"的问题
4. **保持简洁**：避免增加不必要的视觉元素和交互复杂度

### 7.3 已确认的设计要点

#### ✅ 图片尺寸限制

- 最小尺寸：256×256px
- 低于此尺寸不允许上传
- 理由：确保裁剪模式下画框最小尺寸（256px 长边）有意义

#### ✅ 画框默认尺寸

- 16:9 → 1920×1080
- 9:16 → 1080×1920
- 理由：常见的高清分辨率标准

#### ✅ 填充模式初始位置

- 16:9 画框：图片水平居中（左右等比填充）
- 9:16 画框：图片垂直居中（上下等比填充）
- 理由：居中是最常见的需求，用户可自由调整

#### ✅ 输出尺寸跟随画框

- 无固定输出分辨率要求
- 裁剪模式：输出实际画框尺寸
- 填充模式：输出画框默认尺寸
- 理由：灵活性更高，满足不同场景需求

#### ✅ 所见即所得

- 画布即预览，无需额外对比功能
- 底部状态栏提示当前状态和操作指引
- 理由：简化交互，降低学习成本

#### ✅ 保持简单（V1.0）

- 不支持撤销/重做
- 不支持旋转（画框和图片都不旋转）
- 不考虑登录注册等用户系统
- 聚焦核心功能：上传 → 调整 → 导出

---

## 8. 附录

### 8.1 术语表

- **画框**：用户可操作的矩形选区，决定最终输出的图片范围
- **裁剪模式**：图片固定，通过调整画框选择输出区域
- **填充模式**：画框固定，通过移动图片并填充空白区域
- **长边/短边**：图片或画框的较长边/较短边

### 8.2 参考案例

- **Figma 的图片裁剪功能**：裁剪逻辑参考
- **Canva 的图片编辑器**：UI 布局参考
- **微信公众号封面图裁剪工具**：简化交互参考
- **Instagram 图片编辑器**：填充逻辑参考

### 8.3 核心差异化

与通用图片编辑器的区别：

- **专注固定规格输出**：只支持 16:9 和 9:16（后续扩展 1:1 等）
- **明确的模式区分**：用户清楚知道是裁图还是扩图
- **极简交互**：只有移动和缩放两种操作
- **零学习成本**：所见即所得，无复杂概念
- **约束规则简单**：无需辅助线/磁吸等复杂功能

---

**文档版本**：V2.0（已确认）  
**创建日期**：2024-11-18  
**最后更新**：2024-11-18  
**状态**：需求已锁定，可进入开发阶段

**更新日志**：

- V2.0：明确采用手动模式切换设计，移除自动判断逻辑
- V2.0：添加图片最小尺寸限制（256×256px）
- V2.0：明确填充模式初始位置（居中）
- V2.0：确认不需要辅助线/磁吸功能
- V1.0：初始版本
